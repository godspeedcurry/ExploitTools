package main

import (
	"database/sql"
	"fmt"
	_ "github.com/denisenkom/go-mssqldb"
	"log"
	"flag"
)

func main() {
	var query string
	var server string
	var port int
    var user string	
	var pass string
	flag.StringVar( &server,"s","localhost", "server name")
	flag.IntVar( &port, "p", 1433, "port name")
	flag.StringVar(&user, "user", "SA", "username" )
	flag.StringVar(&pass, "pass", "123456", "password" )
	flag.StringVar( &query, "q", "select name from master.dbo.sysdatabases;","your cmd")
	flag.Parse()

	connString := fmt.Sprintf("SERVER=%s;port=%d;user=%s;password=%s", server, port, user, pass)
	fmt.Println("[*]",query)
	conn, err := sql.Open("mssql", connString)
	if err != nil {
		log.Fatal("Open Connection failed:", err.Error())
	}
	defer conn.Close()

	
	//编写查询语句
	stmt, err := conn.Prepare(query)
	if err != nil {
		log.Fatal("Prepare failed:", err.Error())
	}
	defer stmt.Close()

	//执行查询语句
	rows, err := stmt.Query()
	if err != nil {
		log.Fatal("Query failed:", err.Error())
	}
	
	if rows != nil {
        for rows.Next() {
            var key string
            if err := rows.Scan(&key); err == nil {
                fmt.Println(key)
            }
        }
    }
}

